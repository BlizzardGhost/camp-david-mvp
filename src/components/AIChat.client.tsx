import React,{useEffect,useRef,useState} from 'react';
type Msg={role:'user'|'assistant';content:string};
export default function AIChat(){const[msgs,setMsgs]=useState<Msg[]>([{role:'assistant',content:"Hi! I'm your Camp David concierge. Ask me about cottages, what's nearby, or availability."}]);const[input,setInput]=useState('');const box=useRef<HTMLDivElement>(null);useEffect(()=>{box.current?.scrollTo({top:box.current.scrollHeight});},[msgs]);async function send(){if(!input.trim())return;const q=input.trim();setMsgs(m=>[...m,{role:'user',content:q}]);setInput('');const res=await fetch('/api/ai',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({q})});const data=await res.json();setMsgs(m=>[...m,{role:'assistant',content:data.a}]);}return(<div className='fixed bottom-4 right-4 z-50 w-[320px] overflow-hidden rounded-2xl border bg-white shadow-2xl'><div className='bg-brand-600 px-3 py-2 text-white'>Camp David Concierge</div><div ref={box} className='max-h-80 space-y-2 overflow-auto p-3'>{msgs.map((m,i)=>(<div key={i} className={m.role==='user'?'text-right':''}><div className={'inline-block rounded-xl px-3 py-2 '+(m.role==='user'?'bg-neutral-200':'bg-brand-50')}>{m.content}</div></div>))}</div><div className='flex gap-2 border-t p-2'><input aria-label='Message' value={input} onChange={e=>setInput(e.target.value)} onKeyDown={e=>e.key==='Enter'&&send()} className='flex-1 rounded-xl border px-3 py-2' placeholder='Ask about Camp Davidâ€¦'/><button onClick={send} className='rounded-xl bg-brand-600 px-3 py-2 text-white'>Send</button></div></div>);}